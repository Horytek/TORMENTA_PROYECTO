# üå™Ô∏è PROYECTO TORMENTA - ERP/POS Sistema

Sistema de gesti√≥n empresarial (ERP) con punto de venta (POS) integrado.

## üìã Tabla de Contenidos

- [Requisitos Previos](#-requisitos-previos)
- [Instalaci√≥n](#-instalaci√≥n)
- [Configuraci√≥n](#-configuraci√≥n)
- [Comandos Disponibles](#-comandos-disponibles)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [Desarrollo](#-desarrollo)
- [Despliegue](#-despliegue)
- [Seguridad](#-seguridad)
- [Soluci√≥n de Problemas](#-soluci√≥n-de-problemas)

---

## üîß Requisitos Previos

- **Node.js**: versi√≥n 20 o superior
- **MySQL**: versi√≥n 8.0 o superior
- **npm**: incluido con Node.js

---

## üì¶ Instalaci√≥n

### 1. Clonar el repositorio

```bash
git clone <url-del-repositorio>
cd TORMENTA_PROYECTO
```

### 2. Instalar dependencias

```bash
# Instalar dependencias del backend (ra√≠z)
npm install

# Instalar dependencias del frontend
cd client
npm install
cd ..
```

---

## ‚öôÔ∏è Configuraci√≥n

### Variables de Entorno

Crea un archivo `.env` en la carpeta ra√≠z del proyecto con las siguientes variables:

```env
# ========== Base de Datos ==========
DB_HOST=localhost
DB_DATABASE=db_tormenta
DB_USERNAME=root
DB_PASSWORD=tu_password
DB_PORT=3306

# ========== Servidor ==========
NODE_ENV=development
TOKEN_SECRET=tu_secreto_seguro_aqui

# ========== URLs ==========
FRONTEND_URL=http://localhost:5173
VITE_API_URL=http://localhost:4000/api

# ========== APIs Externas (Opcionales) ==========
VITE_GOOGLE_MAPS_API_KEY=tu_api_key
VITE_OPENROUTER_API_KEY=tu_api_key
OPENAI_API_KEY=tu_api_key

# ========== MercadoPago (Opcional) ==========
VITE_MERCADOPAGO_PUBLIC_KEY=tu_public_key
ACCESS_TOKEN=tu_access_token

# ========== Email (Opcional) ==========
RESEND_API_KEY=tu_resend_api_key
SUPPORT_EMAIL=tu_email@ejemplo.com
```

> **Nota**: El frontend (Vite) puede leer las variables `VITE_*` desde el archivo `.env` en la ra√≠z.

---

## üöÄ Comandos Disponibles

### Desarrollo

| Comando | Descripci√≥n |
|---------|-------------|
| `npm run dev` | Inicia solo el servidor backend (Express) |
| `npm run client` | Inicia solo el cliente (React + Vite) |
| `npm run dev:full` | Inicia backend y frontend simult√°neamente |
| `npm run dev:fullstack` | Igual que `dev:full` pero con colores en consola |

### Producci√≥n

| Comando | Descripci√≥n |
|---------|-------------|
| `npm start` | Inicia el servidor en producci√≥n |
| `npm run build:client` | Compila el cliente para producci√≥n |

### Seguridad

| Comando | Descripci√≥n |
|---------|-------------|
| `npm run security:install` | Instala bcryptjs para hash de contrase√±as |
| `npm run migrate:passwords` | Migra contrase√±as a formato hasheado (ejecutar UNA vez) |

---

## üìÅ Estructura del Proyecto

```
TORMENTA_PROYECTO/
‚îú‚îÄ‚îÄ client/                 # Frontend (React + Vite)
‚îÇ   ‚îú‚îÄ‚îÄ src/               # C√≥digo fuente del cliente
‚îÇ   ‚îú‚îÄ‚îÄ public/            # Archivos est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ package.json       # Dependencias del frontend
‚îÇ   ‚îî‚îÄ‚îÄ vite.config.js     # Configuraci√≥n de Vite
‚îÇ
‚îú‚îÄ‚îÄ src/                    # Backend (Express)
‚îÇ   ‚îú‚îÄ‚îÄ controllers/       # Controladores de rutas
‚îÇ   ‚îú‚îÄ‚îÄ routes/            # Definici√≥n de rutas API
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/       # Middlewares (auth, rate limiting)
‚îÇ   ‚îú‚îÄ‚îÄ database/          # Configuraci√≥n de base de datos
‚îÇ   ‚îú‚îÄ‚îÄ services/          # Servicios y l√≥gica de negocio
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # Utilidades y helpers
‚îÇ
‚îú‚îÄ‚îÄ api/                    # Punto de entrada para Vercel
‚îú‚îÄ‚îÄ scripts/                # Scripts de migraci√≥n y utilidades
‚îú‚îÄ‚îÄ uploads/                # Archivos subidos por usuarios
‚îú‚îÄ‚îÄ index.js                # Punto de entrada del servidor
‚îú‚îÄ‚îÄ vercel.json             # Configuraci√≥n de Vercel
‚îî‚îÄ‚îÄ package.json            # Dependencias del backend
```

---

## üíª Desarrollo

### Iniciar entorno de desarrollo completo

```bash
# Opci√≥n 1: En terminales separadas
# Terminal 1 - Backend
npm run dev

# Terminal 2 - Frontend
cd client && npm run dev
```

```bash
# Opci√≥n 2: Todo junto (recomendado)
npm run dev:fullstack
```

### Puertos por defecto

| Servicio | Puerto | URL |
|----------|--------|-----|
| Backend API | 4000 | http://localhost:4000/api |
| Frontend | 5173 | http://localhost:5173 |

---

## üåê Despliegue

### Vercel (Recomendado)

El proyecto est√° configurado para Vercel con el archivo `vercel.json`:

1. Conecta tu repositorio a Vercel
2. Configura las variables de entorno en el panel de Vercel
3. Despliega autom√°ticamente con cada push

### Manual

```bash
# Compilar el cliente
npm run build:client

# Iniciar en producci√≥n
npm start
```

---

## üîê Seguridad

> ‚ö†Ô∏è **IMPORTANTE**: Ejecuta estos pasos antes de ir a producci√≥n.

### Configuraci√≥n inicial de seguridad

```bash
# 1. Instalar bcryptjs
npm run security:install

# 2. Migrar contrase√±as a formato seguro (solo una vez)
npm run migrate:passwords

# 3. Reiniciar el servidor
npm run dev
```

### Caracter√≠sticas de seguridad implementadas

- ‚úÖ **Contrase√±as hasheadas** con bcrypt
- ‚úÖ **Rate limiting**: m√°ximo 5 intentos fallidos por IP
- ‚úÖ **Bloqueo temporal** de 15 minutos tras intentos fallidos
- ‚úÖ **JWT robusto** con validaci√≥n completa
- ‚úÖ **Logs de seguridad** para intentos sospechosos

Para m√°s detalles, consulta `INSTRUCCIONES_SEGURIDAD.md`.

---

## üîß Soluci√≥n de Problemas

### Error: "bcryptjs not found"

```bash
npm install bcryptjs
```

### Error: "Cannot find module"

```bash
npm install
npm run dev
```

### Los usuarios no pueden iniciar sesi√≥n

```bash
# Aseg√∫rate de ejecutar la migraci√≥n de contrase√±as
npm run migrate:passwords
```

### Error de conexi√≥n a base de datos

1. Verifica que MySQL est√© corriendo
2. Confirma las credenciales en `.env`
3. Aseg√∫rate que la base de datos `db_tormenta` exista

### El frontend no carga datos

1. Verifica que el backend est√© corriendo en el puerto 4000
2. Confirma que `VITE_API_URL` en `.env` sea correcto
3. Revisa la consola del navegador por errores CORS

---

## üìö Documentaci√≥n Adicional

| Archivo | Descripci√≥n |
|---------|-------------|
| `INSTRUCCIONES_SEGURIDAD.md` | Gu√≠a completa de seguridad |
| `GUIA_REFACTOR_PERMISOS.md` | Documentaci√≥n del sistema de permisos |
| `RESUMEN_OPTIMIZACIONES.md` | Optimizaciones implementadas |
| `nueva_arquitectura.md` | Arquitectura del sistema |

---

## üõ†Ô∏è Stack Tecnol√≥gico

### Backend
- **Express.js 5** - Framework web
- **MySQL** + **Sequelize** - Base de datos
- **JWT** - Autenticaci√≥n
- **Socket.io** - Comunicaci√≥n en tiempo real
- **Nodemailer/Resend** - Env√≠o de emails

### Frontend
- **React 19** - Biblioteca UI
- **Vite** - Bundler
- **TailwindCSS 4** - Estilos
- **HeroUI/Radix** - Componentes UI
- **Zustand** - Estado global
- **React Router** - Navegaci√≥n

---

## üìû Soporte

Para reportar problemas o solicitar ayuda, crea un issue en el repositorio.